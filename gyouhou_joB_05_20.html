<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>業法_上B_05（20問）</title>
  <style>
    :root{
      --bg:#0b0f18;
      --panel:#0f172a;
      --panel2:#0b1224;
      --border:rgba(255,255,255,.10);
      --text:#e5e7eb;
      --muted:#a3a3a3;
      --accent:#60a5fa;
      --good:#22c55e;
      --bad:#ef4444;
      --warn:#f59e0b;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Hiragino Kaku Gothic ProN", "Noto Sans JP", "Yu Gothic", sans-serif;
      background: radial-gradient(1200px 800px at 20% 10%, rgba(96,165,250,.12), transparent 55%),
                  radial-gradient(1200px 800px at 80% 40%, rgba(34,197,94,.10), transparent 55%),
                  var(--bg);
      color:var(--text);
    }
    .wrap{
      max-width:1100px;
      margin:0 auto;
      padding:18px 14px 60px;
    }
    .top{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      align-items:center;
      justify-content:space-between;
      margin-bottom:12px;
    }
    .title{
      display:flex;
      flex-direction:column;
      gap:4px;
    }
    .title h1{
      font-size:18px;
      margin:0;
      letter-spacing:.5px;
    }
    .title .sub{
      font-size:12px;
      color:var(--muted);
      margin:0;
    }
    .actions{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      justify-content:flex-end;
    }
    button{
      border:1px solid var(--border);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      color:var(--text);
      padding:9px 12px;
      border-radius:12px;
      cursor:pointer;
      font-weight:600;
      font-size:13px;
    }
    button:hover{border-color: rgba(96,165,250,.45)}
    button.primary{
      border-color: rgba(96,165,250,.55);
      box-shadow: 0 0 0 3px rgba(96,165,250,.15);
    }
    .panel{
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
      border:1px solid var(--border);
      border-radius:18px;
      padding:14px;
    }
    .grid{
      display:grid;
      grid-template-columns: 1fr;
      gap:12px;
      margin-top:10px;
    }
    .q{
      background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      border:1px solid var(--border);
      border-radius:18px;
      padding:14px;
    }
    .qhead{
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      gap:10px;
      margin-bottom:10px;
    }
    .qno{
      font-weight:800;
      color: rgba(96,165,250,.95);
      letter-spacing:.3px;
    }
    .badge{
      font-size:12px;
      color:var(--muted);
      border:1px solid var(--border);
      background: rgba(15,23,42,.35);
      padding:6px 10px;
      border-radius:999px;
      white-space:nowrap;
    }
    .block{
      background: rgba(11,18,36,.55);
      border:1px solid var(--border);
      border-radius:16px;
      padding:12px;
      margin-top:10px;
    }
    .block h3{
      margin:0 0 8px 0;
      font-size:12px;
      color:rgba(229,231,235,.9);
      letter-spacing:.2px;
    }
    .block p{
      margin:0;
      line-height:1.65;
      color:rgba(229,231,235,.95);
      font-size:14px;
    }
    .choices{
      margin-top:10px;
      display:grid;
      gap:8px;
    }
    label.choice{
      display:flex;
      align-items:center;
      gap:10px;
      padding:10px 12px;
      border-radius:14px;
      border:1px solid var(--border);
      background: rgba(15,23,42,.35);
      cursor:pointer;
    }
    label.choice:hover{border-color: rgba(96,165,250,.35)}
    input[type="radio"]{
      width:18px;height:18px;
      accent-color: var(--accent);
    }
    .result{
      margin-top:12px;
      padding:10px 12px;
      border-radius:14px;
      border:1px solid var(--border);
      background: rgba(0,0,0,.18);
      display:none;
    }
    .result.good{border-color: rgba(34,197,94,.35)}
    .result.bad{border-color: rgba(239,68,68,.35)}
    .result .line{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      font-size:13px;
      color:rgba(229,231,235,.95);
    }
    .pill{
      padding:4px 10px;
      border-radius:999px;
      border:1px solid var(--border);
      background: rgba(15,23,42,.35);
      color:rgba(229,231,235,.95);
      font-weight:700;
    }
    .pill.good{border-color: rgba(34,197,94,.35); color: rgba(34,197,94,1)}
    .pill.bad{border-color: rgba(239,68,68,.35); color: rgba(239,68,68,1)}
    .hint{
      margin-top:8px;
      font-size:12px;
      color: rgba(245,158,11,.95);
      display:none;
    }

    .bottom{
      margin-top:14px;
      display:grid;
      grid-template-columns: 1fr;
      gap:10px;
    }
    textarea{
      width:100%;
      min-height:110px;
      resize:vertical;
      border-radius:16px;
      border:1px solid var(--border);
      background: rgba(15,23,42,.35);
      color:var(--text);
      padding:12px;
      outline:none;
      line-height:1.5;
      font-size:13px;
    }
    .summary{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:space-between;
    }
    .scorebox{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      align-items:center;
    }
    .scorebig{
      font-weight:900;
      font-size:16px;
      padding:8px 12px;
      border-radius:14px;
      border:1px solid var(--border);
      background: rgba(15,23,42,.35);
    }
    .note{
      font-size:12px;
      color:var(--muted);
      line-height:1.6;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="top">
      <div class="title">
        <h1>業法（宅地建物取引業法） 上B：05（20問）</h1>
        <p class="sub">形式：1問1択／採点・回答コピー・回答貼って復元・リセット</p>
      </div>
      <div class="actions">
        <button class="primary" id="gradeBtn">採点する</button>
        <button id="copyBtn">回答コピー</button>
        <button id="restoreBtn">回答貼って復元</button>
        <button id="resetBtn">リセット</button>
      </div>
    </div>

    <div class="panel">
      <div class="summary">
        <div class="scorebox">
          <span class="scorebig" id="scoreView">未採点</span>
          <span class="badge" id="statusView">※回答が変更された場合は、再度「採点する」が必要です。</span>
        </div>
        <div class="note">
          ※上B：問題文は試験寄り＋（ ）で用語補足＋「日常の言い換え」あり。<br/>
          ※数字（期限・回数・年数）は、ここで固定して覚える用です。
        </div>
      </div>

      <div class="grid" id="qArea"></div>

      <div class="bottom">
        <div class="block">
          <h3>【回答貼り付け欄】</h3>
          <p style="margin-bottom:10px;color:rgba(229,231,235,.85);font-size:12px;">
            形式：Q01=A のような行が並びます。例：Q01=B
          </p>
          <textarea id="pasteArea" placeholder="ここに貼り付け（例：Q01=B）"></textarea>
        </div>
      </div>
    </div>
  </div>

<script>
(function(){
  const KEY = "takken_g_youhou_joB_05_20_answers_v1";

  const questions = [
    {
      no: 1,
      tag: "媒介／REINS",
      q: "専任媒介契約（せんにんばいかいけいやく：1社だけに任せる媒介）を締結した宅地建物取引業者は、指定流通機構（していりゅうつうきこう：REINS）への登録を、原則としていつまでに行わなければならないか。",
      daily: "専任で預かったら、レインズ登録は「何日以内」？",
      choices: [
        "契約締結日から3日以内",
        "契約締結日から7日以内",
        "契約締結日から5日以内",
        "契約締結日から14日以内"
      ],
      ans: "B",
      exp: "専任媒介は、REINS登録が「契約締結日から7日以内」。数字は『専任7』で固定します。"
    },
    {
      no: 2,
      tag: "媒介／REINS",
      q: "専属専任媒介契約（せんぞくせんにんばいかいけいやく：1社だけ＋自己発見取引も不可）を締結した宅地建物取引業者は、指定流通機構（REINS）への登録を、原則としていつまでに行わなければならないか。",
      daily: "専属専任のレインズ登録、何日以内？",
      choices: [
        "契約締結日から3日以内",
        "契約締結日から7日以内",
        "契約締結日から5日以内",
        "契約締結日から14日以内"
      ],
      ans: "C",
      exp: "専属専任媒介は、REINS登録が「契約締結日から5日以内」。数字は『専属5』で固定します。"
    },
    {
      no: 3,
      tag: "媒介／報告義務",
      q: "専任媒介契約（せんにんばいかいけいやく）を締結した宅地建物取引業者は、依頼者に対し、業務処理状況（ぎょうむしょりじょうきょう：活動の報告）を少なくとも何週間に1回以上報告しなければならないか。",
      daily: "専任は、活動報告を「何週間に1回」？",
      choices: [
        "1週間に1回以上",
        "2週間に1回以上",
        "3週間に1回以上",
        "4週間に1回以上"
      ],
      ans: "B",
      exp: "専任媒介の報告は『2週間に1回以上』。専属専任は『1週間に1回以上』と区別します。"
    },
    {
      no: 4,
      tag: "媒介／報告義務",
      q: "専属専任媒介契約（せんぞくせんにんばいかいけいやく）を締結した宅地建物取引業者は、依頼者に対し、業務処理状況（活動の報告）を少なくとも何週間に1回以上報告しなければならないか。",
      daily: "専属専任は、活動報告を「何週間に1回」？",
      choices: [
        "1週間に1回以上",
        "2週間に1回以上",
        "3週間に1回以上",
        "4週間に1回以上"
      ],
      ans: "A",
      exp: "専属専任媒介の報告は『1週間に1回以上』。専任（2週間）より短いです。"
    },
    {
      no: 5,
      tag: "媒介／自己発見取引",
      q: "専任媒介契約（せんにんばいかいけいやく）において、依頼者は自己発見取引（じこはっけんとりひき：自分で見つけた相手と直接契約）をすることができるか。",
      daily: "専任で任せても、自分で相手見つけて直契約できる？",
      choices: [
        "できる",
        "できない",
        "宅建士（たっけんし）がいる場合のみできる",
        "相手が宅建業者の場合のみできる"
      ],
      ans: "A",
      exp: "専任媒介は自己発見取引が『できる』。できないのは専属専任です。"
    },
    {
      no: 6,
      tag: "媒介／自己発見取引",
      q: "専属専任媒介契約（せんぞくせんにんばいかいけいやく）において、依頼者は自己発見取引（自分で見つけた相手と直接契約）をすることができるか。",
      daily: "専属専任でも、自己発見で直契約できる？",
      choices: [
        "できる",
        "できない",
        "依頼者が売主（うりぬし）の場合のみできる",
        "依頼者が買主（かいぬし）の場合のみできる"
      ],
      ans: "B",
      exp: "専属専任媒介は自己発見取引が『できない』。この一点が専任との大きい差です。"
    },
    {
      no: 7,
      tag: "35条",
      q: "重要事項説明（じゅうようじこうせつめい：35条説明）は、原則として、いつまでに行わなければならないか。",
      daily: "35条の説明って、いつまでにやる？",
      choices: [
        "契約締結後すみやかに",
        "契約締結前までに",
        "引渡し（ひきわたし：物を渡す）までに",
        "登記（とうき：名義の登録）までに"
      ],
      ans: "B",
      exp: "35条（重要事項説明）は『契約前までに』。契約後では遅いです。"
    },
    {
      no: 8,
      tag: "37条",
      q: "37条書面（さんじゅうななじょうしょめん：契約内容を書いた書面）の交付は、原則として、いつ行わなければならないか。",
      daily: "37条の書面は、いつ渡す？",
      choices: [
        "契約締結前までに",
        "契約締結後、遅滞なく（ちたいなく：すぐに）",
        "引渡しまでに",
        "代金全額支払い後"
      ],
      ans: "B",
      exp: "37条書面は『契約後、遅滞なく交付』。35条（契約前）とセットで混ぜないのがコツです。"
    },
    {
      no: 9,
      tag: "取引士",
      q: "重要事項説明（35条説明）を行う者として正しいものはどれか。",
      daily: "35条説明は、誰ができる？",
      choices: [
        "宅地建物取引士（たっけんし）であればできる",
        "宅建業者の従業者（じゅうぎょうしゃ）なら誰でもできる",
        "売主（うりぬし）が一般人でもできる",
        "買主（かいぬし）が希望すれば誰でもできる"
      ],
      ans: "A",
      exp: "35条説明は『宅地建物取引士』が行います（取引士証を提示して説明）。"
    },
    {
      no: 10,
      tag: "標識・証明書",
      q: "宅地建物取引業者は、従業者証明書（じゅうぎょうしゃしょうめいしょ：身分証のようなもの）を、従業者に携帯（けいたい：持ち歩き）させなければならないが、提示（ていじ：見せる）を求められた場合、原則としてどうする必要があるか。",
      daily: "従業者証明書、求められたら？",
      choices: [
        "その場で提示しなければならない",
        "後日郵送でよい",
        "会社に戻ってからでよい",
        "提示義務はない"
      ],
      ans: "A",
      exp: "従業者証明書は携帯＋『求められたら提示』が原則です。"
    },
    {
      no: 11,
      tag: "報酬",
      q: "宅建業者が受け取ることができる媒介報酬（ばいかいほうしゅう：仲介手数料）について、売買（ばいばい）の場合、上限額は原則として何により定まるか。",
      daily: "仲介手数料の上限って、何で決まる？",
      choices: [
        "当事者の合意だけで自由に決まる",
        "国土交通大臣（こくどこうつうだいじん）の定める額の範囲内",
        "都道府県知事（とどうふけんちじ）の許可があれば自由",
        "宅建業者の社内規定だけで決まる"
      ],
      ans: "B",
      exp: "媒介報酬の上限は『国土交通大臣が定める額の範囲内』。合意だけで無制限にはできません。"
    },
    {
      no: 12,
      tag: "広告",
      q: "宅建業者が、売主（うりぬし）から依頼を受けて媒介する物件について広告（こうこく：募集表示）をする場合、事実に反する表示（うそ表示）をしてはならないのは当然として、原則としていつから広告してよいか。",
      daily: "広告って、いつから出していい？",
      choices: [
        "媒介契約を締結する前でも自由にできる",
        "媒介契約を締結した後であればできる",
        "売買契約が成立してからでないとできない",
        "引渡し後でないとできない"
      ],
      ans: "B",
      exp: "原則は『媒介契約を締結した後』に広告。前提として誇大広告（盛りすぎ）や虚偽広告（うそ）は禁止です。"
    },
    {
      no: 13,
      tag: "申込金等",
      q: "宅建業者が、宅地建物の売買について、契約締結前に申込金（もうしこみきん）や預り金（あずかりきん）などの名目で金銭を受領（じゅりょう：受け取る）することについて、原則として正しいものはどれか。",
      daily: "契約前に『申込金』とか取っていい？",
      choices: [
        "どんな名目でも一切受け取れない",
        "一定の条件のもとで受け取れる場合がある",
        "必ず受け取らなければならない",
        "宅建士が受領すれば自由に受け取れる"
      ],
      ans: "B",
      exp: "契約前の金銭受領は『一切ダメ』ではなく、扱いが問題になります（不当な履行確保（りこうかくほ：ムリやり縛る）や誤認（ごにん：勘違いさせる）にならない運用が必要）。試験では禁止類型を問われがちです。"
    },
    {
      no: 14,
      tag: "クーリング・オフ",
      q: "宅建業者が売主（うりぬし）となる宅地建物の売買について、買主（かいぬし）がクーリング・オフ（一定期間の無条件解約）を主張できるのは、原則としてどのような場合か。",
      daily: "業者売主のクーリングオフ、どんな時に使える？",
      choices: [
        "常に無条件で使える",
        "宅建業者の事務所等以外で申込み等をした場合など、要件を満たすとき",
        "登記が終わるまでならいつでも使える",
        "引渡し後でも必ず使える"
      ],
      ans: "B",
      exp: "クーリング・オフは『常に』ではなく、事務所等以外での申込み等など、法律の要件を満たす場合に使えます。"
    },
    {
      no: 15,
      tag: "手付（業者売主）",
      q: "宅建業者が売主となる売買で、買主から受け取る手付金（てつけきん）について、原則として正しいものはどれか。",
      daily: "業者売主の手付金、上限ルールある？",
      choices: [
        "売買代金の2割を超えて受け取ってはならない",
        "売買代金の3割を超えて受け取ってはならない",
        "上限はない",
        "必ず現金でしか受け取れない"
      ],
      ans: "A",
      exp: "業者売主の手付金は『2割超はダメ』が基本。あわせて手付金等の保全（ほぜん：守る仕組み）が絡む問題も出ます。"
    },
    {
      no: 16,
      tag: "8種制限（損害賠償予定）",
      q: "宅建業者が売主となる売買で、損害賠償額の予定（そんがいばいしょうがくのよてい：違反時の賠償を先に決める）および違約金（いやくきん）について、原則として上限は売買代金の何割か。",
      daily: "違約金とか賠償予定、上限は何割？",
      choices: [
        "1割",
        "2割",
        "3割",
        "4割"
      ],
      ans: "B",
      exp: "8種制限の代表：損害賠償予定・違約金の上限は『2割』。"
    },
    {
      no: 17,
      tag: "8種制限（解除）",
      q: "宅建業者が売主となる売買で、買主が手付解除（てつけかいじょ：手付を放棄して解除）できる時期について、原則として正しいものはどれか。",
      daily: "手付解除はいつまでできる？",
      choices: [
        "引渡しまでいつでもできる",
        "相手方が履行（りこう：実行）に着手（ちゃくしゅ：取りかかる）するまでできる",
        "契約後1週間だけできる",
        "登記が終わるまでできる"
      ],
      ans: "B",
      exp: "手付解除は『相手方が履行に着手するまで』が基本。期限日数ではなく“着手”で切れます。"
    },
    {
      no: 18,
      tag: "帳簿",
      q: "宅建業者は取引に関する帳簿（ちょうぼ：記録）を備え付け、一定期間保存しなければならないが、保存期間として正しいものはどれか。",
      daily: "取引の帳簿、何年保存？",
      choices: [
        "1年",
        "3年",
        "5年",
        "10年"
      ],
      ans: "C",
      exp: "帳簿の保存は『5年』が基本として出ます（細部例外はありますが、まず5年で固定）。"
    },
    {
      no: 19,
      tag: "免許",
      q: "宅建業の免許（めんきょ：営業許可）の有効期間として正しいものはどれか。",
      daily: "宅建業免許、何年ごと更新？",
      choices: [
        "3年",
        "5年",
        "7年",
        "10年"
      ],
      ans: "B",
      exp: "宅建業免許は『5年』有効。更新も5年ごと、が基本です。"
    },
    {
      no: 20,
      tag: "取引士設置",
      q: "宅建業者は、事務所（じむしょ）ごとに一定数の宅地建物取引士（たっけんし）を置かなければならないが、原則として必要な割合として正しいものはどれか。",
      daily: "取引士って、事務所に何人割合で要る？",
      choices: [
        "従業者の10人に1人以上",
        "従業者の5人に1人以上",
        "従業者の3人に1人以上",
        "従業者の2人に1人以上"
      ],
      ans: "B",
      exp: "事務所の取引士は『5人に1人以上』が原則（専任の取引士）。数字は“5分の1”。"
    }
  ];

  const qArea = document.getElementById("qArea");
  const scoreView = document.getElementById("scoreView");
  const statusView = document.getElementById("statusView");
  const pasteArea = document.getElementById("pasteArea");

  function pad2(n){ return String(n).padStart(2,"0"); }
  function qKey(no){ return `Q${pad2(no)}`; }

  function loadAnswers(){
    try{
      const raw = localStorage.getItem(KEY);
      if(!raw) return {};
      return JSON.parse(raw) || {};
    }catch(e){ return {}; }
  }
  function saveAnswers(obj){
    localStorage.setItem(KEY, JSON.stringify(obj));
  }

  let answers = loadAnswers();
  let graded = false;

  function markNeedRegrade(){
    graded = false;
    scoreView.textContent = "未採点";
    statusView.textContent = "※回答が変更された場合は、再度「採点する」が必要です。";
    document.querySelectorAll(".result").forEach(el=>el.style.display="none");
    document.querySelectorAll(".hint").forEach(el=>el.style.display="none");
  }

  function render(){
    qArea.innerHTML = "";
    questions.forEach(q=>{
      const div = document.createElement("div");
      div.className = "q";
      div.innerHTML = `
        <div class="qhead">
          <div class="qno">${qKey(q.no)}</div>
          <div class="badge">${q.tag}</div>
        </div>

        <div class="block">
          <h3>【問題文（試験風）】</h3>
          <p>${escapeHtml(q.q)}</p>
        </div>

        <div class="block">
          <h3>【日常の言い換え】</h3>
          <p>${escapeHtml(q.daily)}</p>
        </div>

        <div class="block">
          <h3>【選択肢】（1つ選ぶ）</h3>
          <div class="choices" id="choices_${q.no}"></div>
        </div>

        <div class="result" id="result_${q.no}">
          <div class="line" id="line_${q.no}"></div>
          <div class="hint" id="hint_${q.no}">※回答が変更されたため、再度「採点する」が必要です。</div>
        </div>
      `;
      qArea.appendChild(div);

      const cWrap = div.querySelector(`#choices_${q.no}`);
      const letters = ["A","B","C","D"];
      q.choices.forEach((txt, i)=>{
        const letter = letters[i];
        const id = `q_${q.no}_${letter}`;
        const label = document.createElement("label");
        label.className = "choice";
        label.innerHTML = `
          <input type="radio" name="q_${q.no}" id="${id}" value="${letter}">
          <div><b style="display:inline-block;width:22px">${letter}</b> ${escapeHtml(txt)}</div>
        `;
        cWrap.appendChild(label);

        const input = label.querySelector("input");
        if(answers[qKey(q.no)] === letter) input.checked = true;

        input.addEventListener("change", ()=>{
          answers[qKey(q.no)] = letter;
          saveAnswers(answers);
          if(graded){
            // 採点済み後に変更したら、その問だけヒント表示
            document.getElementById(`hint_${q.no}`).style.display = "block";
          }
          markNeedRegrade();
        });
      });
    });
  }

  function grade(){
    let correct = 0;
    questions.forEach(q=>{
      const picked = answers[qKey(q.no)] || "";
      const ok = picked === q.ans;
      if(ok) correct++;

      const res = document.getElementById(`result_${q.no}`);
      const line = document.getElementById(`line_${q.no}`);
      const hint = document.getElementById(`hint_${q.no}`);
      hint.style.display = "none";

      res.classList.remove("good","bad");
      res.classList.add(ok ? "good" : "bad");
      res.style.display = "block";

      const yourPill = picked ? `<span class="pill ${ok ? "good":"bad"}">あなた：${picked}</span>` : `<span class="pill bad">あなた：未選択</span>`;
      const ansPill  = `<span class="pill good">正解：${q.ans}</span>`;
      const expP     = `<span class="pill" style="border-color:rgba(255,255,255,.18);font-weight:600">解説：${escapeHtml(q.exp)}</span>`;

      line.innerHTML = `
        <span class="pill ${ok ? "good":"bad"}">${ok ? "正解" : "不正解"}</span>
        ${yourPill}
        ${ansPill}
        ${expP}
      `;
    });

    graded = true;
    scoreView.textContent = `${correct} / ${questions.length}`;
    statusView.textContent = "採点済み（回答を変更した場合は未採点状態に戻ります）";
  }

  function buildCopyText(){
    const lines = [];
    questions.forEach(q=>{
      const k = qKey(q.no);
      const v = answers[k] || "";
      lines.push(`${k}=${v}`);
    });
    return lines.join("\n");
  }

  function restoreFromText(text){
    const map = {};
    const lines = (text || "").split(/\r?\n/).map(s=>s.trim()).filter(Boolean);
    lines.forEach(line=>{
      const m = line.match(/^(Q\d{2})\s*=\s*([ABCD])\s*$/i);
      if(m){
        map[m[1].toUpperCase()] = m[2].toUpperCase();
      }
    });
    // 反映
    let changed = false;
    Object.keys(map).forEach(k=>{
      if(answers[k] !== map[k]){
        answers[k] = map[k];
        changed = true;
      }
    });
    if(changed){
      saveAnswers(answers);
      render();          // 再描画して反映
      markNeedRegrade(); // 採点状態リセット
    }
  }

  function resetAll(){
    answers = {};
    saveAnswers(answers);
    pasteArea.value = "";
    render();
    markNeedRegrade();
  }

  function escapeHtml(str){
    return String(str)
      .replaceAll("&","&amp;")
      .replaceAll("<","&lt;")
      .replaceAll(">","&gt;")
      .replaceAll('"',"&quot;")
      .replaceAll("'","&#39;");
  }

  document.getElementById("gradeBtn").addEventListener("click", grade);

  document.getElementById("copyBtn").addEventListener("click", async ()=>{
    const txt = buildCopyText();
    pasteArea.value = txt;
    try{
      await navigator.clipboard.writeText(txt);
      statusView.textContent = "回答をコピーしました（貼り付け欄にも出しています）";
    }catch(e){
      statusView.textContent = "回答を貼り付け欄に出しました（端末設定でコピー不可の場合があります）";
    }
  });

  document.getElementById("restoreBtn").addEventListener("click", ()=>{
    restoreFromText(pasteArea.value);
    statusView.textContent = "貼り付け内容から復元しました（形式：Q01=A）";
  });

  document.getElementById("resetBtn").addEventListener("click", ()=>{
    resetAll();
    statusView.textContent = "リセットしました";
  });

  render();
})();
</script>
</body>
</html>
