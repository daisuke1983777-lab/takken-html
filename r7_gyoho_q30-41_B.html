<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>宅建 令和7年 公式過去問｜業法 問30〜41（B）</title>
  <style>
    :root{
      /* ===== 白背景（ライト）版 ===== */
      --bg:#ffffff;
      --card:#ffffff;
      --card2:#f7f8fb;
      --text:#0b0f14;
      --muted:#556274;
      --line:#d7dde6;
      --ok:#16a34a;
      --ng:#e11d48;
      --btn:#f3f4f6;
      --btn2:#e5e7eb;
      --accent:#2563eb;
      --warn:#b45309;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, "Hiragino Kaku Gothic ProN", "Noto Sans JP", "Yu Gothic", sans-serif;
      background:#ffffff; /* 背景は白固定 */
      color:var(--text);
    }
    header{
      padding:24px 16px 12px;
      max-width:1100px;
      margin:0 auto;
    }
    h1{
      margin:0 0 6px;
      font-size:20px;
      letter-spacing:.02em;
    }
    .sub{
      margin:0;
      color:var(--muted);
      font-size:13px;
      line-height:1.5;
    }
    .wrap{
      max-width:1100px;
      margin:0 auto;
      padding:12px 16px 36px;
    }
    .panel{
      background:rgba(255,255,255,.92);
      border:1px solid var(--line);
      border-radius:14px;
      padding:14px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      position:sticky;
      top:0;
      backdrop-filter: blur(10px);
      z-index:10;
    }
    button{
      border:1px solid var(--line);
      background:var(--btn);
      color:var(--text);
      padding:10px 12px;
      border-radius:12px;
      cursor:pointer;
      font-weight:700;
      font-size:13px;
    }
    button:hover{ border-color:#9fb3d9; }
    button.primary{ background:#eef2ff; border-color:#2563eb; }
    button.danger{ background:#fff1f2; border-color:#e11d48; color:#9f1239;}
    button.ghost{ background:transparent; }
    .stat{
      margin-left:auto;
      display:flex;
      gap:12px;
      align-items:baseline;
      flex-wrap:wrap;
    }
    .stat b{font-size:14px}
    .stat span{color:var(--muted); font-size:13px}
    .note{
      width:100%;
      color:var(--muted);
      font-size:12px;
      line-height:1.6;
      margin-top:4px;
    }

    .restore{
      margin-top:12px;
      background:rgba(255,255,255,.9);
      border:1px dashed #9fb3d9;
      border-radius:14px;
      padding:12px;
    }
    .restore label{
      display:block;
      font-weight:700;
      font-size:13px;
      margin-bottom:6px;
    }
    textarea{
      width:100%;
      min-height:90px;
      resize:vertical;
      border-radius:12px;
      border:1px solid var(--line);
      background:#ffffff;
      color:var(--text);
      padding:10px;
      font-size:13px;
      line-height:1.5;
      outline:none;
    }
    .grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:14px;
      margin-top:14px;
    }
    @media (max-width:980px){
      .grid{ grid-template-columns:1fr; }
      .stat{ margin-left:0; width:100%;}
    }
    .qcard{
      background:rgba(255,255,255,.95);
      border:1px solid var(--line);
      border-radius:16px;
      padding:14px;
    }
    .qhead{
      display:flex;
      justify-content:space-between;
      gap:10px;
      align-items:flex-start;
      margin-bottom:10px;
    }
    .qid{
      font-weight:900;
      letter-spacing:.02em;
    }
    .tag{
      font-size:12px;
      padding:5px 10px;
      border-radius:999px;
      border:1px solid var(--line);
      color:var(--muted);
      background:rgba(0,0,0,.02);
      white-space:nowrap;
    }
    .blocktitle{
      margin:10px 0 6px;
      font-size:12px;
      color:var(--muted);
      letter-spacing:.04em;
    }
    .box{
      border:1px solid var(--line);
      border-radius:14px;
      padding:10px 12px;
      background:rgba(0,0,0,.02);
      line-height:1.65;
      font-size:13px;
    }
    .choices{
      margin-top:10px;
      display:flex;
      flex-direction:column;
      gap:8px;
    }
    .choice{
      border:1px solid var(--line);
      border-radius:14px;
      padding:10px 12px;
      background:rgba(0,0,0,.01);
      display:flex;
      gap:10px;
      align-items:flex-start;
      cursor:pointer;
    }
    .choice:hover{ border-color:#9fb3d9; }
    .choice input{ margin-top:3px; transform:scale(1.1); }
    .choice .cbody{ flex:1; }
    .choice .clabel{ font-weight:900; margin-right:8px; color:#1d4ed8; }
    .result{
      margin-top:10px;
      border-radius:14px;
      padding:10px 12px;
      border:1px solid var(--line);
      background:rgba(0,0,0,.02);
      display:none;
    }
    .result.ok{ border-color:rgba(22,163,74,.55); background:rgba(22,163,74,.08); }
    .result.ng{ border-color:rgba(225,29,72,.55); background:rgba(225,29,72,.06); }
    .result .line1{ font-weight:900; margin-bottom:6px; }
    .result .small{ color:var(--muted); font-size:12px; line-height:1.6; }
    .muted{ color:var(--muted); }
    .pill{
      display:inline-block;
      padding:3px 8px;
      border-radius:999px;
      border:1px solid var(--line);
      font-size:12px;
      color:var(--muted);
      margin-left:8px;
      background:rgba(0,0,0,.01);
    }
    .warn{
      color:var(--warn);
      font-weight:800;
    }
    .foot{
      margin-top:18px;
      color:var(--muted);
      font-size:12px;
      line-height:1.6;
    }
  </style>
</head>
<body>
  <header>
    <h1>宅建 公式過去問（令和7年）問1〜問4（B：日常訳あり／白背景）</h1>
    <p class="sub">
      表示順は固定：問題文（試験風）→ 日常の言い換え → 選択肢。<br/>
      1問1択。採点後にだけ「正解＋ピンポイント解説」を表示。<br/>
      「回答をコピー」→ 文字列をメモ → 消えても「回答を貼って復元」で戻せます。端末内保存（localStorage）対応。
    </p>
  </header>

  <div class="wrap">
    <div class="panel">
      <button class="primary" id="btnScore">採点する</button>
      <button class="ghost" id="btnShowExp">解説を表示</button>
      <button class="ghost" id="btnCopy">回答をコピー</button>
      <button class="ghost" id="btnSave">回答を保存</button>
      <button class="ghost" id="btnRestore">回答を貼って復元</button>
      <button class="danger" id="btnReset">リセット</button>

      <div class="stat">
        <b id="statText">合計：4問中 0 正解（未採点）</b>
        <span id="statSub">未回答：4 / 4</span>
      </div>

      <div class="note">
        ※解説は「採点」後にだけ表示されます。<br/>
        ※「保存」はこの端末のブラウザ内です（ログイン不要・他端末には移りません）。
      </div>
    </div>

    <div class="restore">
      <label>復元用（必要なときだけ）</label>
      <textarea id="restoreBox" placeholder="ここに『回答をコピー』で出た文字列を貼ってから『回答を貼って復元』"></textarea>
      <div class="foot">※この欄は普段は使いません（事故の保険）。</div>
    </div>

    <div class="grid" id="qGrid"></div>

    <div class="foot">
      注意：このセットは「公式過去問（令和7年）問1〜問4／B（日常訳あり）」のサンプルです。<br/>
      A運用にするときは、daily を空文字（""）にして同じ形のまま回します（UIはいじらない前提）。
    </div>
  </div>

<script>
(function(){
  // ====== 問題データ ======
  // ルール：Bは「日常訳あり（必須）」＋「専門用語は直後に（）で日本語言い換え」
 const questions = [
  {
    id: 30,
    question:
"【問 30】 いずれも宅地建物取引業者であるＡ社、Ｂ社及びＣ社（以下この問において「売\n主ら」という。）が、分譲マンションを共同で建築、販売することとなり、建築確認を受けた\n後、工事完了前にその一室を5,000万円で宅地建物取引業者ではない個人である買主に売却し\nようとする場合に関する次の記述のうち、宅地建物取引業法（以下この問において「法」とい\nう。）に違反するものはいくつあるか。\nア 売主らは、共同する全社が各個に重要事項説明を実施すると、かえって買主を混乱させる\nと考え、買主の了解を得た上で、Ａ社 1 社を幹事社とし、Ａ社の宅地建物取引士が単独で重\n要事項説明書に記名のうえ、買主に交付し説明を行った。\nイ 売主らは、Ａ社の事務所において買主から買受けの申込みを受け、売買契約を締結した\nが、売主らは当該売買契約には法第37条の 2 の規定に基づくいわゆるクーリング・オフの\n適用はないと判断し、クーリング・オフについて買主に告げる書面の交付は行わなかった。\nウ 売主らは、当該物件については、重要事項説明の時点では共用部分に関する規約が案であ\nるので、買主の了解を得た上で、契約締結後に、案が確定した規約を買主に交付することと\nした。\nエ 売主らは、当該売買契約に関し、買主から手付金300万円を受領したが、手付金の保全措\n置は講じなかった。",
    daily: "",
    options: ["1 一つ", "2 二つ", "3 三つ", "4 四つ"],
    answer: 0,
    explanation: ""
  },
  {
    id: 31,
    question:
"【問 31】 次の記述のうち、宅地建物取引業法により禁止されている行為が含まれているも\nのはいくつあるか。\nア 宅地建物取引士が、マンション販売の勧誘を電話で行うにあたり、まず、契約締結につい\nて勧誘する目的である旨を告げたうえで、自分の名前は名乗らず、自身の勤務する宅地建物\n取引業者の名称及び免許番号を伝えたうえで勧誘を行った。\nイ 宅地建物取引業者が、賃貸マンションの媒介で入居申込者から申込みを受け付けたとこ\nろ、当該マンションのオーナーからの審査回答待ちとなった。その後、入居申込者が、申込\nみを撤回したい旨電話で伝えたところ、当該宅地建物取引業者の従業員から声を荒げ「撤回\nをするなら、とりあえず事務所まで来てくれないと困る」と怒鳴られ、面会を強要され\nた。申込者はその言動に不安を覚えたため、事務所に赴いて、申込みの撤回を申し出たとこ\nろ、申込みの撤回が了承された。\nウ 宅地建物取引業者が、一時的にアルバイトを雇って、マンション販売の広告チラシの配布\nを行わせることとしたほか、契約書の作成業務も補助的に行わせるため、従業者証明書をそ\nの者に発行し、それらの業務を行わせた。ただし、そのアルバイトはマンション販売の広告\nチラシの配布の際には、従業者証明書を携帯していなかった。\nエ マンションの販売の勧誘における説明において、宅地建物取引士は、日当たりのよいマン\nションの購入希望者に対して、「マンション南側の月極駐車場は出来たばかりであり、将来\nにわたりそこにマンションなどの高層の建物が建つ予定は全くない」と説明し、購入希望者\nから購入申込みを受け付けた。",
    daily: "",
    options: ["1 一つ", "2 二つ", "3 三つ", "4 四つ"],
    answer: 0,
    explanation: ""
  },
  {
    id: 32,
    question:
"【問 32】 宅地建物取引業者Ａが、自ら売主として、宅地建物取引業者ではないＢとの間で\nマンション（代金4,000万円）の売買契約を締結した場合に関する次の記述のうち、宅地建物\n取引業法（以下この問において「法」という。）の規定に違反しないものはどれか。\n1 Ａは、建築工事完了前のマンションの売買契約を締結する際にＢから手付金200万円を受\n領し、さらに建築工事中に200万円を中間金として受領した後、当該手付金と中間金につい\nて法第41条に定める保全措置を講じた。\n2 Ａは、建築工事完了後のマンションの売買契約を締結する際に、法第41条の2に定める保\n全措置を講じることなくＢから手付金400万円を受領した。\n3 Ａは、建築工事完了前のマンションの売買契約を締結する際にＢから手付金500万円を受\n領したが、Ｂに債務不履行がないにもかかわらず当該手付金500万円を返還して、契約を一\n方的に解除した。\n4 Ａは、建築工事完了後のマンションの売買契約を締結する際に、当事者の債務の不履行を\n理由とする契約の解除に伴う損害賠償の予定額を1,000万円とする特約を定めた。",
    daily: "",
    options: ["1", "2", "3", "4"],
    answer: 0,
    explanation: ""
  },
  {
    id: 33,
    question:
"【問 33】 宅地建物取引業者Ａが、専任の宅地建物取引士である従業者Ｂに宅地建物取引業\n法第35条に規定する重要事項の説明（以下この問において「重要事項説明」という。）を行わ\nせる場合に関する次の記述のうち、宅地建物取引業法の規定によれば、誤っているものはどれ\nか。\n1 Ａが、Ｂに重要事項説明を行わせる場合、Ｂは、重要事項説明書に記名しなければならな\nい。\n2 Ａが、Ｂに重要事項説明を行わせる場合、Ｂは、重要事項説明書を相手方に交付しなけれ\nばならない。\n3 Ａが、Ｂに重要事項説明を行わせる場合、Ｂは、重要事項説明に先立ち、宅地建物取引士\n証を提示しなければならない。\n4 Ａが、Ｂに重要事項説明を行わせる場合、Ｂが宅地建物取引士証を提示すれば、重要事項\n説明書の記名は不要である。",
    daily: "",
    options: ["1", "2", "3", "4"],
    answer: 0,
    explanation: ""
  },
  {
    id: 34,
    question:
"【問 34】 宅地建物取引業の免許（以下この問において「免許」という。）に関する次の記\n述のうち、宅地建物取引業法の規定によれば、正しいものはいくつあるか。\nア Ａ社の政令で定める使用人Ｂは、刑法第234条（威力業務妨害）の罪により、懲役2年、\n執行猶予2年の刑に処せられた後、Ａ社を退任し、新たにＣ社の政令で定める使用人に就任\nした。Ｂの執行猶予期間が満了していない場合に、Ｃ社が免許を申請しても、免許を受ける\nことができない。\nイ Ｄ社は、不正の手段により免許を取得したことによる免許の取消処分に係る聴聞の期日及\nび場所が公示された日から当該処分がなされるまでの間に、宅地建物取引業法第11条の規\n定による廃業の届出をした。その廃業に相当の理由がなかった場合、当該公示の日の40日\n前にＤ社の取締役を退任したＥは、当該届出から5年経過しなければ、免許を申請しても免\n許を受けることができない。\nウ Ｆ社は、免許の申請前3年以内に宅地建物取引業法の規定により罰金の刑に処せられた\nことがあるが、免許を申請しても免許を受けることができる。\nエ Ｇ社は、免許の有効期間満了後も引き続き宅地建物取引業を営もうとする場合、免許の有\n効期間満了日前90日から30日までの間に免許の更新の申請をしなければならない。",
    daily: "",
    options: ["1 一つ", "2 二つ", "3 三つ", "4 四つ"],
    answer: 0,
    explanation: ""
  },
  {
    id: 35,
    question:
"【問 35】 宅地建物取引業者Ａ（甲県知事免許）の営業保証金に関する次の記述のうち、宅\n地建物取引業法の規定によれば、正しいものはどれか。なお、Ａは宅地建物取引業保証協会の\n社員ではないものとする。\n1 免許の有効期間満了の際、Ａが営業保証金を取り戻そうとする場合には、供託した営業保\n証金につき還付を受ける権利を有する者に対し、6か月を下らない一定期間内に申し出るべ\nき旨を官報に公告しなければならない。\n2 Ａは、免許を受けた後、主たる事務所の移転を行った場合、営業保証金を供託した供託所\nに対して、遅滞なくその旨を届け出なければならない。\n3 Ａが免許を受けた後に営業保証金を供託する場合、供託所は、Ａが営業保証金を供託した\n旨を、甲県知事に通知しなければならない。\n4 Ａが免許を受けた後に営業保証金を供託する場合、Ａは、当該営業保証金を供託した日か\nら2週間以内に、甲県知事にその旨を届け出なければならない。",
    daily: "",
    options: ["1", "2", "3", "4"],
    answer: 0,
    explanation: ""
  },
  {
    id: 36,
    question:
"【問 36】 宅地建物取引業者Ａが行う媒介契約に関する次の記述のうち、宅地建物取引業法\nの規定によれば、誤っているものはどれか。\n1 Ａが専任媒介契約を締結した場合、Ａは、指定流通機構への登録義務がある。\n2 Ａが専属専任媒介契約を締結した場合、Ａは、依頼者に対し、業務処理状況の報告を1週\n間に1回以上行わなければならない。\n3 Ａが専属専任媒介契約を締結した場合、Ａは、指定流通機構への登録を当該契約締結の日\nから5日以内にしなければならない。\n4 Ａが専任媒介契約を締結した場合、Ａは、指定流通機構への登録を当該契約締結の日から\n7日以内にしなければならない。",
    daily: "",
    options: ["1", "2", "3", "4"],
    answer: 0,
    explanation: ""
  },
  {
    id: 37,
    question:
"【問 37】 宅地建物取引業者が行う宅地建物取引業法第35条に規定する重要事項の説明に\n関する次の記述のうち、正しいものはどれか。なお、説明の相手方は宅地建物取引業者ではな\nいものとする。\n1 建物の貸借の媒介を行う場合、当該建物が都市計画法の準防火地域内にあり、建築基準法\n第61条第1項に基づく建物の構造に係る制限があるときは、その概要を説明しなければならな\nい。\n2 マンションの分譲を行う場合、建物の区分所有等に関する法律第2条第3項に規定する専\n用部分の用途その他の利用の制限に関する規約の定めが案の段階であるときは、説明する必要\nはない。\n3 建物の貸借の媒介を行う場合、借賃以外に授受される金銭の額、授受の目的及び保管方法\nを説明しなければならない。\n4 鉄筋コンクリート造の既存の共同住宅の販売を行う場合、宅地建物取引業法第34条の2\n第1項第4号に規定する建物状況調査を1年6か月前に実施したときは、建物状況調査を実施\nしたこと、その結果の概要について説明しなくてはならない。",
    daily: "",
    options: ["1", "2", "3", "4"],
    answer: 0,
    explanation: ""
  },
  {
    id: 38,
    question:
"【問 38】 宅地建物取引業者Ａが行う業務に関する次の記述のうち、宅地建物取引業法の規\n定によれば、誤っているものはいくつあるか。\nア Ａは、宅地又は建物の売買に関する広告をする際に取引態様の別を明示した場合、当該広\n告を見た者から売買に関する注文を受けたときは、改めて取引態様の別を明示する必要はな\nい。\nイ Ａは、宅地の売買に関する広告をするに当たり、当該宅地の形質について、実際のものよ\nりも著しく優良であると人を誤認させる表示をした場合、当該宅地に関する注文がなく、売\n買が成立しなかったときであっても、監督処分及び罰則の対象となる。\nウ Ａは、複数の区画がある宅地の売買について、数回に分けて広告をする予定でいる場\n合、最初に行う広告に取引態様の別を明示すれば足り、それ以降は明示する必要はない。\nエ Ａは、建物の貸借の媒介において、依頼者の依頼によらない広告をした場合、国土交通大\n臣の定める報酬限度額を超えて報酬を受領することができる。",
    daily: "",
    options: ["1 一つ", "2 二つ", "3 三つ", "4 四つ"],
    answer: 0,
    explanation: ""
  },
  {
    id: 39,
    question:
"【問 39】 宅地建物取引業者Ａが、ＢからＢ所有の中古住宅の売却について媒介の依頼を受\nけた場合における次の記述のうち、宅地建物取引業法（以下この問において「法」という。）\nの規定によれば、正しいものはどれか。\n1 ＡがＢとの間で専属専任媒介契約を締結し、Ｂから「売り出し中であることを秘密にして\nおきたいので指定流通機構への登録はしないでほしい」旨の申出があった場合、Ａは、その\nことを理由に登録をしないことができる。\n2 ＡがＢとの間で専属専任媒介契約を締結した場合、Ａは、当該契約締結の日から3日以内\nに指定流通機構への登録をしなければならない。\n3 ＡがＢとの間で専属専任媒介契約を締結した場合、Ａは、Ｂに対し、業務処理状況の報告\nを1週間に1回以上行わなければならない。\n4 ＡがＢとの間で専任媒介契約を締結した場合、Ａは、Ｂに対し、業務処理状況の報告を2\n週間に1回以上行わなければならない。",
    daily: "",
    options: ["1", "2", "3", "4"],
    answer: 0,
    explanation: ""
  },
  {
    id: 40,
    question:
"【問 40】 宅地建物取引業者Ａが、自ら売主として、宅地建物取引業者Ｂの媒介により、宅\n地建物取引業者ではない買主Ｃとの間で宅地の売買契約を締結した場合、宅地建物取引業法第\n37条の2の規定に基づくいわゆるクーリング・オフに関する次の記述のうち、正しいものは\nいくつあるか。\nア Ｃは、Ｂの事務所で買受けの申込みを行い、その3日後に、Ｃの自宅近くの喫茶店で売買\n契約を締結した場合、クーリング・オフによる契約の解除はできない。\nイ ＡとＣの間で、クーリング・オフによる契約の解除に関し、Ｃは契約の解除の書面をクー\nリング・オフの告知の日から起算して8日以内にＡに到達させなければ契約を解除すること\nができない旨の特約を定めた場合、当該特約は無効である。\nウ Ｃは、Ｂからの提案によりＣの自宅で買受けの申込みを行ったが、クーリング・オフにつ\nいては告げられず、その10日後に、Ａの事務所で売買契約を締結した場合、クーリング・オ\nフによる契約の解除はできる。\nエ Ｃは、Ｂの事務所で買受けの申込みを行い、その3日後に、Ｃの自宅で売買契約を締結\nしたが、Ｂの従業者から、クーリング・オフについて告げる書面が交付されなかった場合、\nクーリング・オフによる契約の解除はできる。",
    daily: "",
    options: ["1 一つ", "2 二つ", "3 三つ", "4 四つ"],
    answer: 0,
    explanation: ""
  },
  {
    id: 41,
    question:
"【問 41】 宅地建物取引業の免許（以下この問において「免許」という。）に関する次の記\n述のうち、宅地建物取引業法の規定によれば、正しいものはどれか。",
    daily: "",
    options: [
      "1 宅地建物取引業者Ａ（甲県知事免許）が免許を受けてから1年以内に事業を開始しないときは、甲県知事は免許を取り消さなければならない。",
      "2 宅地建物取引業者Ｂ（甲県知事免許）が株主総会の決議により解散した場合、Ｂを代表する役員であった者は、その旨を当該解散の日から60日以内に甲県知事に届け出なければならない。",
      "3 宅地建物取引業者ではないＣが甲県に本店を、乙県に支店をそれぞれ有する場合で、乙県の支店のみで新たに宅地建物取引業を営もうとするときは、Ｃは乙県知事の免許を受けなければならない。",
      "4 宅地建物取引業者Ｄ（甲県知事免許）は、甲県の事務所を廃止し、乙県内で新たに事務所を設置して宅地建物取引業を営もうとする場合、甲県知事へ廃業の届出を行うとともに、乙県知事への免許換えの申請を行わなければならない。"
    ],
    answer: 0,
    explanation: ""
  }
];


  // ====== DOM生成 ======
  const qGrid = document.getElementById("qGrid");

  function esc(s){
    return s.replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
  }

  function makeCard(q){
    const card = document.createElement("div");
    card.className = "qcard";
    card.id = `q${q.id}`;

    const head = document.createElement("div");
    head.className = "qhead";
    head.innerHTML = `<div class="qid">Q${q.id}</div><div class="tag">${esc(q.tag)}</div>`;
    card.appendChild(head);

    const bt1 = document.createElement("div");
    bt1.className = "blocktitle";
    bt1.textContent = "【問題文（試験風）】";
    card.appendChild(bt1);

    const b1 = document.createElement("div");
    b1.className = "box";
    b1.textContent = q.stem;
    card.appendChild(b1);

    const bt2 = document.createElement("div");
    bt2.className = "blocktitle";
    bt2.textContent = "【日常の言い換え】";
    card.appendChild(bt2);

    const b2 = document.createElement("div");
    b2.className = "box";
    b2.textContent = q.daily;
    card.appendChild(b2);

    const bt3 = document.createElement("div");
    bt3.className = "blocktitle";
    bt3.textContent = "【選択肢】（1つ選ぶ）";
    card.appendChild(bt3);

    const choices = document.createElement("div");
    choices.className = "choices";

    q.choices.forEach((c, idx) => {
      const label = String.fromCharCode(65 + idx); // A,B,C,D
      const row = document.createElement("label");
      row.className = "choice";
      row.innerHTML = `
        <input type="radio" name="q_${q.id}" value="${idx}" />
        <div class="cbody">
          <span class="clabel">${label}</span>
          <span>${esc(c)}</span>
        </div>
      `;
      choices.appendChild(row);
    });
    card.appendChild(choices);

    const res = document.createElement("div");
    res.className = "result";
    res.id = `res_${q.id}`;
    res.innerHTML = `
      <div class="line1"></div>
      <div class="small"></div>
    `;
    card.appendChild(res);

    return card;
  }

  questions.forEach(q => qGrid.appendChild(makeCard(q)));

  // ====== 状態管理 ======
  const KEY_SAVE = "takkenset_te-tsuke_mix_v1";
  let scored = false;

  function getSelected(qid){
    const el = document.querySelector(`input[name="q_${qid}"]:checked`);
    return el ? Number(el.value) : null;
  }
  function setSelected(qid, val){
    const el = document.querySelector(`input[name="q_${qid}"][value="${val}"]`);
    if(el) el.checked = true;
  }
  function clearSelected(qid){
    const els = document.querySelectorAll(`input[name="q_${qid}"]`);
    els.forEach(e => e.checked = false);
  }

  function countUnanswered(){
    let n = 0;
    questions.forEach(q => { if(getSelected(q.id) === null) n++; });
    return n;
  }

  function updateStats(){
    const unanswered = countUnanswered();
    document.getElementById("statSub").textContent = `未回答：${unanswered} / ${questions.length}`;
    if(!scored){
      document.getElementById("statText").textContent = `合計：${questions.length}問中 0 正解（未採点）`;
    }
  }

  function score(){
    let correct = 0;
    questions.forEach(q => {
      const sel = getSelected(q.id);
      const res = document.getElementById(`res_${q.id}`);
      const line1 = res.querySelector(".line1");
      const small = res.querySelector(".small");

      res.style.display = "block";

      if(sel === null){
        res.classList.remove("ok","ng");
        res.classList.add("ng");
        line1.innerHTML = `未回答 <span class="pill">正解：${String.fromCharCode(65+q.answer)}</span>`;
        small.textContent = "採点後に解説を表示できます。まずはどれか1つ選んでください。";
        return;
      }

      if(sel === q.answer){
        correct++;
        res.classList.remove("ng");
        res.classList.add("ok");
        line1.innerHTML = `正解 <span class="pill">あなた：${String.fromCharCode(65+sel)}</span>`;
      }else{
        res.classList.remove("ok");
        res.classList.add("ng");
        line1.innerHTML = `不正解 <span class="pill">あなた：${String.fromCharCode(65+sel)}</span> <span class="pill">正解：${String.fromCharCode(65+q.answer)}</span>`;
      }
      small.textContent = "（解説は『解説を表示』で表示）";
    });

    scored = true;
    document.getElementById("statText").textContent = `合計：${questions.length}問中 ${correct} 正解（採点済）`;
    updateStats();
    return correct;
  }

  function showExplanations(){
    if(!scored){
      alert("先に『採点する』を押してください。");
      return;
    }
    questions.forEach(q => {
      const res = document.getElementById(`res_${q.id}`);
      const sel = getSelected(q.id);
      const small = res.querySelector(".small");
      const ansLabel = String.fromCharCode(65+q.answer);
      const yourLabel = (sel===null) ? "未回答" : String.fromCharCode(65+sel);
      small.innerHTML =
        `<div class="muted">正解：<b>${ansLabel}</b> ／ あなた：<b>${esc(yourLabel)}</b></div>` +
        `<div style="margin-top:6px;line-height:1.65">${esc(q.exp)}</div>`;
    });
  }

  function buildAnswerString(){
    const parts = questions.map(q => {
      const sel = getSelected(q.id);
      return `${q.id}=${sel===null ? "x" : sel}`;
    });
    return `v1|${parts.join(",")}`;
  }

  function applyAnswerString(str){
    const s = (str||"").trim();
    if(!s.startsWith("v1|")) throw new Error("形式が違います（v1|...）");
    const body = s.slice(3);
    const kvs = body.split(",").map(x => x.trim()).filter(Boolean);

    questions.forEach(q => clearSelected(q.id));

    kvs.forEach(kv => {
      const [k,v] = kv.split("=");
      const qid = Number(k);
      if(!Number.isFinite(qid)) return;
      const q = questions.find(x => x.id === qid);
      if(!q) return;
      if(v === "x") return;
      const val = Number(v);
      if(Number.isFinite(val) && val >= 0 && val < 4){
        setSelected(qid, val);
      }
    });

    scored = false;
    questions.forEach(q => {
      const res = document.getElementById(`res_${q.id}`);
      res.style.display = "none";
      res.classList.remove("ok","ng");
      res.querySelector(".line1").textContent = "";
      res.querySelector(".small").textContent = "";
    });
    updateStats();
    document.getElementById("statText").textContent = `合計：${questions.length}問中 0 正解（未採点）`;
  }

  function saveLocal(){
    const payload = {
      v: 1,
      ts: Date.now(),
      ans: buildAnswerString()
    };
    localStorage.setItem(KEY_SAVE, JSON.stringify(payload));
  }

  function loadLocal(){
    const raw = localStorage.getItem(KEY_SAVE);
    if(!raw) return null;
    try{
      const obj = JSON.parse(raw);
      if(!obj || !obj.ans) return null;
      return obj.ans;
    }catch(e){
      return null;
    }
  }

  function resetAll(){
    if(!confirm("全回答をリセットします。よろしいですか？")) return;
    questions.forEach(q => clearSelected(q.id));
    scored = false;
    questions.forEach(q => {
      const res = document.getElementById(`res_${q.id}`);
      res.style.display = "none";
      res.classList.remove("ok","ng");
      res.querySelector(".line1").textContent = "";
      res.querySelector(".small").textContent = "";
    });
    localStorage.removeItem(KEY_SAVE);
    document.getElementById("restoreBox").value = "";
    updateStats();
    document.getElementById("statText").textContent = `合計：${questions.length}問中 0 正解（未採点）`;
  }

  document.getElementById("btnScore").addEventListener("click", () => {
    const unanswered = countUnanswered();
    if(unanswered === questions.length){
      if(!confirm("まだ1問も選ばれていません。採点すると未回答が多く出ますが続けますか？")) return;
    }
    score();
  });

  document.getElementById("btnShowExp").addEventListener("click", () => {
    showExplanations();
  });

  document.getElementById("btnCopy").addEventListener("click", async () => {
    const s = buildAnswerString();
    try{
      await navigator.clipboard.writeText(s);
      alert("回答をコピーしました。メモに貼って保存できます。");
    }catch(e){
      document.getElementById("restoreBox").value = s;
      alert("クリップボードにコピーできなかったため、復元欄に入れました。手動でコピーしてください。");
    }
  });

  document.getElementById("btnSave").addEventListener("click", () => {
    saveLocal();
    alert("端末内に保存しました。");
  });

  document.getElementById("btnRestore").addEventListener("click", () => {
    const s = document.getElementById("restoreBox").value;
    try{
      applyAnswerString(s);
      alert("復元しました（未採点状態に戻しました）。");
    }catch(e){
      alert("復元に失敗しました： " + e.message);
    }
  });

  document.getElementById("btnReset").addEventListener("click", () => {
    resetAll();
  });

  document.addEventListener("change", (ev) => {
    if(ev.target && ev.target.matches('input[type="radio"]')){
      updateStats();
      if(scored){
        scored = false;
        document.getElementById("statText").textContent = `合計：${questions.length}問中 0 正解（未採点）`;
        questions.forEach(q => {
          const res = document.getElementById(`res_${q.id}`);
          if(res.style.display === "block"){
            res.querySelector(".small").innerHTML = `<span class="warn">※回答が変更されたため、再度『採点する』が必要です。</span>`;
          }
        });
      }
    }
  });

  const saved = loadLocal();
  if(saved){
    document.getElementById("restoreBox").value = saved;
  }

  updateStats();
})();
</script>
</body>
</html>
